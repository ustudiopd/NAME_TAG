# 명찰 출력 프로그램 - Cursor AI Rules (프로젝트 헌법)

## 🎯 프로젝트 개요
이 프로젝트는 PyQt5 기반의 명찰(이름표) 디자인 및 출력 프로그램입니다.
- PyQt5 + Python 3.13 + pandas + Pillow + openpyxl
- 엑셀 명단 기반 명찰 제작 시스템
- 드래그 앤 드롭 인터페이스로 직관적인 디자인

## 🔄 Plan/Act 모드 (필수 준수)

### 기본 모드: PLAN
- AI는 항상 **Plan 모드**로 시작합니다
- Plan 모드에서는 **절대로** 코드를 생성하거나 수정하지 않습니다
- 사용자가 코드 변경을 요구해도 계획 승인이 우선임을 알립니다
- 매 응답마다 현재 모드를 `# Mode: PLAN` 또는 `# Mode: ACT`로 표시합니다

### Plan 모드 행동 규칙
1. **계획 수립만 수행**: 코드 작성 없이 필요한 정보 수집 및 솔루션 설계
2. **상세한 계획 제공**: 변경할 파일 목록, 단계별 작업 내용, 예상 결과
3. **사용자 승인 대기**: 계획이 완성되면 사용자의 명시적 승인을 기다림
4. **메모리 뱅크 참조**: 관련 MD 파일들을 참조하여 일관성 유지

### Act 모드 전환 조건
- 사용자가 명시적으로 **"ACT"** 또는 **"실행해"**라고 지시할 때만 전환
- 승인된 계획을 바탕으로만 실제 코드 변경 수행
- 작업 완료 후 자동으로 Plan 모드로 복귀

## 📚 메모리 뱅크 활용

### 필수 참조 문서
작업 시 다음 문서들을 우선 참조하세요:
- `memory_bank/projectbrief.md`: 프로젝트 개요 및 목표
- `memory_bank/techContext.md`: PyQt5 기술 스택 및 환경 정보
- `memory_bank/systemPatterns.md`: 아키텍처 패턴 및 코딩 규칙
- `memory_bank/productContext.md`: 비즈니스 로직 및 기능 동작
- `memory_bank/activeContext.md`: 현재 작업 상황
- `memory_bank/progress.md`: 완료된 작업 내역

### 메모리 뱅크 업데이트
- 작업 완료 후 "update memory bank" 지시 시 관련 문서 업데이트
- 새로운 기능 추가 시 `plan.md` 생성 후 구현
- 중요한 변경사항은 `progress.md`에 기록

## 🛠️ PyQt5 코딩 규칙

### 클래스 구조
```python
# 메인 윈도우 클래스
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_connections()
        self.setup_data()
    
    def setup_ui(self):
        # UI 구성
        pass
    
    def setup_connections(self):
        # 시그널/슬롯 연결
        pass
    
    def setup_data(self):
        # 데이터 초기화
        pass
```

### 이벤트 처리
```python
# 이벤트 핸들러 명명 규칙
def on_action_triggered(self):
    pass

def on_button_clicked(self):
    pass

def on_text_changed(self):
    pass
```

### 시그널/슬롯 패턴
```python
# 커스텀 시그널 정의
class CustomWidget(QWidget):
    dataChanged = pyqtSignal(str)
    
    def __init__(self):
        super().__init__()
        self.setup_connections()
    
    def setup_connections(self):
        self.dataChanged.connect(self.handle_data_change)
```

## 🎨 UI 컴포넌트 규칙

### 텍스트 아이템
```python
class CenteredTextItem(QGraphicsTextItem):
    positionChanged = pyqtSignal(float, float)
    
    def __init__(self, text, font_size=16):
        super().__init__(text)
        self.setup_text_item(font_size)
    
    def setup_text_item(self, font_size):
        self.setFont(QFont("Arial", font_size))
        self.setFlag(QGraphicsItem.ItemIsMovable, True)
        self.setFlag(QGraphicsItem.ItemIsSelectable, True)
```

### 이미지 처리
```python
def load_image_safely(self, file_path):
    """안전한 이미지 로드"""
    try:
        pixmap = QPixmap(file_path)
        if pixmap.isNull():
            raise ValueError("이미지 파일을 로드할 수 없습니다.")
        return pixmap
    except Exception as e:
        QMessageBox.warning(self, "오류", f"이미지 로드 실패: {str(e)}")
        return None
```

## 📊 데이터 처리 규칙

### 엑셀 데이터 처리
```python
def process_excel_data(self, file_path):
    """엑셀 데이터 처리"""
    try:
        # 1. 파일 검증
        if not self.validate_excel_file(file_path):
            return None
        
        # 2. 데이터 로드
        df = pd.read_excel(file_path)
        
        # 3. 필수 컬럼 확인
        required_cols = ["이름", "회사명", "직급"]
        if not all(col in df.columns for col in required_cols):
            raise ValueError("필수 컬럼이 없습니다.")
        
        # 4. 데이터 정리
        df = self.clean_data(df)
        
        return df
        
    except Exception as e:
        QMessageBox.warning(self, "오류", f"엑셀 처리 실패: {str(e)}")
        return None
```

### 에러 처리
```python
def safe_operation(self, operation, error_message, parent=None):
    """안전한 작업 실행"""
    try:
        return operation()
    except Exception as e:
        QMessageBox.warning(parent or self, "오류", f"{error_message}: {str(e)}")
        return None
```

## 🔒 보안 및 안정성 규칙

### 파일 처리
- 모든 파일 경로 검증
- 지원되는 파일 형식만 허용
- 파일 크기 제한 적용

### 메모리 관리
- 이미지 로드 시 크기 제한
- 사용하지 않는 객체 정리
- 메모리 누수 방지

### 사용자 입력 검증
- 모든 사용자 입력 검증
- SQL 인젝션 방지 (필요시)
- XSS 방지 (필요시)

## 📈 성능 최적화 규칙

### 렌더링 최적화
```python
def update_preview_optimized(self):
    """최적화된 미리보기 업데이트"""
    # 불필요한 리페인트 방지
    if not self.needs_update:
        return
    
    self.scene.update()
    self.needs_update = False
```

### 메모리 최적화
```python
def load_image_optimized(self, file_path, max_size=1000):
    """최적화된 이미지 로드"""
    pixmap = QPixmap(file_path)
    
    # 크기 제한
    if pixmap.width() > max_size or pixmap.height() > max_size:
        pixmap = pixmap.scaled(
            max_size, max_size, 
            Qt.KeepAspectRatio, 
            Qt.SmoothTransformation
        )
    
    return pixmap
```

## 🧪 테스트 및 품질 규칙

### 코드 품질
- 의미 있는 변수명 사용
- 함수당 50줄 이하 유지
- 복잡한 로직은 주석으로 설명

### 에러 처리
- 모든 예외 상황 처리
- 사용자 친화적 에러 메시지
- 로깅을 통한 문제 추적

## 🔄 워크플로우

### 새로운 기능 개발
1. **Plan**: `plan.md` 생성 및 상세 계획 수립
2. **Review**: 사용자가 계획 검토 및 승인
3. **Act**: 승인된 계획에 따라 구현
4. **Update**: 메모리 뱅크 업데이트

### 버그 수정
1. **Plan**: 문제 분석 및 해결 방안 수립
2. **Review**: 해결 방안 검토
3. **Act**: 수정 사항 구현
4. **Test**: 수정 사항 검증

## 📝 문서화 규칙

### 필수 문서
- 모든 새로운 기능에 대한 `plan.md` 생성
- 중요한 변경사항은 `progress.md`에 기록
- 복잡한 로직은 주석으로 설명

### 메모리 뱅크 유지
- 정기적인 문서 업데이트
- 프로젝트 상태 반영
- 팀원과의 지식 공유

## 🎯 명찰 프로그램 특화 규칙

### 명찰 디자인 규칙
- A4 용지 기준 (595x842 픽셀)
- 최소 여백 10px 유지
- 텍스트 크기 8pt 이상
- 이미지 비율 유지

### 데이터 검증 규칙
- 이름: 1-20자, 특수문자 제한
- 회사명: 1-50자
- 직급: 1-20자
- 이미지: 최대 5MB, 지원 형식만

### 출력 규칙
- 300 DPI 권장
- CMYK 색상 권장
- 세로 방향 고정

---

**중요**: 이 규칙들은 AI의 행동을 제어하고 프로젝트의 일관성을 유지하기 위한 것입니다. 모든 작업은 Plan/Act 모드를 준수하며, 메모리 뱅크를 적극 활용하여 컨텍스트를 유지하세요.

---
**작성일**: 2025년 9월 13일  
**버전**: 1.0  
**프로젝트**: 명찰 출력 프로그램

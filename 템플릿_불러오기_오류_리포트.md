# 템플릿 불러오기 오류 리포트

## 📋 오류 정보

### 오류 메시지
```
TypeError: reviver is not a function
```

### 발생 위치
- **파일**: `lib/editor/EditorCore.js`
- **라인**: 826번째 줄
- **함수**: `EditorCore.loadTemplate()`
- **메서드**: `this.fabric.util.enlivenObjects()`

### 호출 스택
```
EditorCore.loadTemplate (lib\editor\EditorCore.js:798:13)
loadTemplate (hooks\useNamecardEditor.js:266:38)
loadTemplate (components\EventDetailView_new.js:93:28)
onTemplateSelect (components\NamecardTemplateManager.js:161:8)
```

## 🔍 문제 분석

### 현재 코드 상태
```javascript
// lib/editor/EditorCore.js:826
this.fabric.util.enlivenObjects(
  nonImageObjects,
  (enlivenedObjects) => {
    enlivenedObjects.forEach((obj) => {
      this.canvas.add(obj)
    })
    this.loadImageObjects(imageObjects, resolve)
  },
  null,      // reviver 함수 (null = 기본 reviver 사용)
  'fabric',  // namespace
  this.fabric // fabric 객체 명시적 전달
)
```

### 문제점
1. **API 시그니처 불일치**: Fabric.js v5의 `enlivenObjects` API 시그니처가 예상과 다를 가능성
2. **reviver 파라미터 처리**: `null`을 전달했지만 여전히 "reviver is not a function" 오류 발생
3. **Fabric.js 버전 확인 필요**: 실제 사용 중인 Fabric.js 버전과 API 문서의 시그니처 불일치 가능성

### 오류 발생 시나리오
1. 사용자가 템플릿 저장 완료
2. 저장된 템플릿을 불러오기 시도
3. `NamecardTemplateManager`에서 템플릿 선택
4. `EventDetailView_new.js`의 `handleTemplateSelect` 호출
5. `useNamecardEditor`의 `loadTemplate` 명령 실행
6. `EditorCore.loadTemplate()` 메서드 실행
7. `fabric.util.enlivenObjects()` 호출 시 오류 발생

## 🔬 근본 원인 추정

### 가능성 1: Fabric.js v5 API 시그니처 변경
Fabric.js v5에서 `enlivenObjects`의 시그니처가 다음과 같이 변경되었을 가능성:
- **예상 시그니처**: `(objects, callback, reviver, namespace, fabricInstance)`
- **실제 시그니처**: 다른 형태일 수 있음

### 가능성 2: reviver 파라미터 필수 여부
- `null`을 전달했지만 함수가 필수일 수 있음
- 또는 `undefined`를 전달해야 할 수도 있음

### 가능성 3: 파라미터 순서 오류
- `namespace`와 `fabricInstance`의 순서가 잘못되었을 가능성
- 또는 일부 파라미터가 선택적이지만 전달 방식이 잘못됨

## 📚 참고 정보

### 기존 코드에서의 사용 예시
`components/CanvasEditor_new.js`에서는 `loadFromJSON`을 사용하거나 수동 객체 생성을 사용하고 있음:
- `loadFromJSON` 사용: `canvas.loadFromJSON(jsonData, callback)`
- 수동 객체 생성: 각 객체 타입별로 직접 생성

### Fabric.js 버전 확인 필요
- `package.json`에서 실제 Fabric.js 버전 확인 필요
- 버전에 따른 API 시그니처 차이 확인 필요

## 🎯 해결 방안 제안

### 방안 1: Fabric.js 공식 문서 확인
- Fabric.js v5의 `enlivenObjects` 정확한 시그니처 확인
- 공식 문서나 타입 정의 파일 참조

### 방안 2: loadFromJSON 사용으로 전환
- `enlivenObjects` 대신 `canvas.loadFromJSON()` 사용
- 이미지 객체는 별도로 처리
- `CanvasEditor_new.js`의 `loadOptimizedTemplate` 패턴 참고

### 방안 3: 수동 객체 생성 방식
- `enlivenObjects` 사용하지 않고 각 객체 타입별로 직접 생성
- `CanvasEditor_new.js`의 `loadOptimizedTemplate` 구현 참고
- 더 안정적이지만 코드가 길어짐

### 방안 4: Fabric.js 버전 다운그레이드 또는 업그레이드
- 현재 버전과 호환되는 API 사용
- 또는 최신 버전으로 업그레이드 후 최신 API 사용

## 📝 추가 조사 필요 사항

1. **Fabric.js 버전 확인**
   - `package.json`에서 실제 버전 확인
   - `node_modules/fabric/package.json` 확인

2. **API 문서 확인**
   - Fabric.js v5 공식 문서에서 `enlivenObjects` 시그니처 확인
   - 타입 정의 파일(`.d.ts`) 확인

3. **대안 방법 검토**
   - `loadFromJSON` 사용 가능 여부 확인
   - `CanvasEditor_new.js`의 구현 방식 검토

## 🚨 우선순위

**높음**: 템플릿 불러오기 기능이 완전히 작동하지 않음
- 사용자가 저장한 템플릿을 불러올 수 없음
- 배경 이미지 및 모든 JSON 설정이 적용되지 않음

## 📌 관련 파일

- `lib/editor/EditorCore.js` (826번째 줄)
- `hooks/useNamecardEditor.js` (266번째 줄)
- `components/EventDetailView_new.js` (93번째 줄)
- `components/NamecardTemplateManager.js` (161번째 줄)
- `components/CanvasEditor_new.js` (참고용 구현)

## 🔗 참고 자료

- Fabric.js 공식 문서: https://github.com/fabricjs/fabric.js
- Fabric.js v5 API 문서 확인 필요
- `CanvasEditor_new.js`의 `loadOptimizedTemplate` 구현 참고

---

**리포트 작성일**: 2025-01-XX  
**오류 심각도**: 높음  
**영향 범위**: 템플릿 불러오기 기능 전체


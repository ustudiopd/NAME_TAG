# 명찰 출력 프로그램 - 경품추첨 기능 개발 계획

## 🎁 경품추첨 기능 개요

사용자가 제안한 구조에 따라 **출력 패널 하단에 접을 수 있는 경품추첨 탭**을 추가하고, **템플릿처럼 경품추첨을 생성**할 수 있게 하며, **각 경품추첨마다 설정과 실행 탭**을 가지는 구조로 구현합니다.

---

## 📋 UI 구조 설계

### 1. 출력 패널 구조
```
출력 패널
├── 템플릿 관리 (기존)
└── 경품추첨 (새로 추가)
    ├── 접기/펼치기 토글 버튼
    └── 경품추첨 목록 (펼쳤을 때만 표시)
        ├── "새 경품추첨 생성" 버튼
        └── 생성된 경품추첨 카드들
            ├── 경품추첨 제목
            ├── 설정 탭
            │   ├── 기본 정보 설정
            │   ├── 경품 정보 설정
            │   ├── 추첨 대상 설정
            │   ├── 추첨 방식 설정
            │   └── 시나리오 설정
            └── 실행 탭
                ├── 실시간 추첨 애니메이션
                ├── 결과 표시
                └── 결과 관리
```

### 2. 경품추첨 카드 구조
- **헤더**: 경품추첨 제목, 상태 표시, 편집/삭제 버튼
- **탭 네비게이션**: 설정 | 실행
- **설정 탭**: 상세 시나리오 설정 폼
- **실행 탭**: 추첨 실행 및 결과 표시

---

## 🗄️ 데이터베이스 스키마 (현재 상태)

### ✅ 이미 생성된 테이블들

#### 1. prize_draws 테이블 (경품추첨 세션)
| 컬럼명 | 데이터 타입 | NULL 허용 | 설명 |
|--------|-------------|-----------|------|
| id | uuid | NO | 기본 키 (자동 생성) |
| event_id | uuid | YES | 행사 ID (외래키) |
| title | text | NO | 경품추첨 제목 |
| description | text | YES | 경품추첨 설명 |
| is_active | boolean | YES | 활성 상태 (기본값: true) |
| created_at | timestamp with time zone | YES | 생성 시간 |
| updated_at | timestamp with time zone | YES | 수정 시간 |

#### 2. prizes 테이블 (경품 정보)
| 컬럼명 | 데이터 타입 | NULL 허용 | 설명 |
|--------|-------------|-----------|------|
| id | uuid | NO | 기본 키 (자동 생성) |
| prize_draw_id | uuid | YES | 경품추첨 ID (외래키) |
| name | text | NO | 경품명 |
| description | text | YES | 경품 설명 |
| quantity | integer | NO | 수량 (기본값: 1) |
| rank_order | integer | NO | 등수 순서 (1등, 2등, 3등) |
| image_url | text | YES | 경품 이미지 URL |
| created_at | timestamp with time zone | YES | 생성 시간 |

#### 3. prize_winners 테이블 (추첨 결과)
| 컬럼명 | 데이터 타입 | NULL 허용 | 설명 |
|--------|-------------|-----------|------|
| id | uuid | NO | 기본 키 (자동 생성) |
| prize_draw_id | uuid | YES | 경품추첨 ID (외래키) |
| prize_id | uuid | YES | 경품 ID (외래키) |
| profile_id | uuid | YES | 참가자 ID (외래키) |
| won_at | timestamp with time zone | YES | 당첨 시간 (기본값: now()) |

---

## 🧩 컴포넌트 구조

### 1. PrizeDrawPanel (메인 패널)
- **기능**: 출력 패널 하단에 위치, 접기/펼치기 토글
- **상태**: `isExpanded` (패널 펼침/접힘 상태)
- **자식**: `PrizeDrawManager`

### 2. PrizeDrawManager (경품추첨 관리)
- **기능**: 경품추첨 목록 표시, 새 경품추첨 생성
- **상태**: `prizeDraws` (경품추첨 목록)
- **자식**: `PrizeDrawCard` 배열

### 3. PrizeDrawCard (개별 경품추첨)
- **기능**: 경품추첨 정보 표시, 탭 네비게이션
- **상태**: `activeTab` (설정/실행 탭), `prizeDraw` (경품추첨 데이터)
- **자식**: `PrizeDrawSettings`, `PrizeDrawExecution`

### 4. PrizeDrawSettings (설정 탭)
- **기능**: 경품추첨 상세 설정
- **설정 항목**:
  - 기본 정보 (제목, 설명)
  - 경품 정보 (이름, 설명, 수량, 순서)
  - 추첨 대상 (전체/체크인된 참가자/특정 조건)
  - 추첨 방식 (순차/동시/단계별)
  - 애니메이션 설정 (속도, 효과, 사운드)

### 5. PrizeDrawExecution (실행 탭)
- **기능**: 추첨 실행 및 결과 표시
- **구성 요소**:
  - 참가자 목록 표시
  - 추첨 시작/중지 버튼
  - 실시간 애니메이션 영역
  - 결과 표시 영역
  - 결과 내보내기 기능

---

## ⚙️ 핵심 기능 구현

### 1. 경품추첨 생성/관리
- **생성**: 새 경품추첨 세션 생성
- **편집**: 기존 경품추첨 수정
- **삭제**: 경품추첨 삭제 (확인 후)
- **복사**: 기존 경품추첨 복사

### 2. 설정 관리
- **경품 정보**: 이름, 설명, 수량, 순서, 이미지
- **추첨 대상**: 
  - 전체 참가자
  - 체크인된 참가자만
  - 특정 조건 (회사별, 직급별 등)
- **추첨 방식**:
  - 순차 추첨 (3등 → 2등 → 1등)
  - 동시 추첨 (모든 등수 동시)
  - 단계별 추첨 (사용자 제어)
- **애니메이션 설정**:
  - 스크롤 속도
  - 정지 시간
  - 효과 종류
  - 사운드 효과

### 3. 추첨 실행
- **중복 방지**: 이미 당첨된 참가자 제외
- **실시간 애니메이션**: 룰렛 스타일 스크롤
- **결과 표시**: 당첨자 카드 표시
- **결과 저장**: 데이터베이스에 결과 저장

### 4. 결과 관리
- **결과 조회**: 과거 추첨 결과 확인
- **결과 내보내기**: Excel/PDF 내보내기
- **결과 삭제**: 추첨 결과 삭제

---

## 🎨 시각 효과 및 애니메이션

### 1. 룰렛 스크롤 애니메이션
- **CSS Transform**: `translateY`를 사용한 수직 스크롤
- **속도 조절**: 설정에서 조절 가능한 스크롤 속도
- **정지 효과**: 서서히 멈추는 자연스러운 애니메이션

### 2. 당첨자 발표 효과
- **카드 애니메이션**: 당첨자 카드가 나타나는 효과
- **순차 표시**: 등수별로 순차적으로 표시
- **축하 효과**: confetti 라이브러리 사용

### 3. 반응형 레이아웃
- **그리드 시스템**: 당첨자 수에 따른 유동적 레이아웃
- **모바일 지원**: 터치 친화적 인터페이스

---

## 🚀 구현 단계

### Phase 1: 기본 구조 (1-2일)
1. **데이터베이스 API 함수 구현**
   - `lib/prizeDrawDatabase.js` 생성
   - CRUD 함수들 구현
2. **기본 컴포넌트 구조 생성**
   - `PrizeDrawPanel` 컴포넌트
   - `PrizeDrawManager` 컴포넌트
3. **출력 패널에 경품추첨 탭 추가**
   - `OutputPanel.js` 수정

### Phase 2: 경품추첨 관리 (2-3일)
1. **경품추첨 CRUD 기능 구현**
   - 생성, 수정, 삭제, 복사 기능
2. **설정 탭 기본 기능 구현**
   - 기본 정보 설정
   - 경품 정보 관리
3. **데이터베이스 연동 테스트**

### Phase 3: 추첨 실행 (3-4일)
1. **추첨 로직 구현**
   - 중복 방지 알고리즘
   - 랜덤 선택 로직
2. **실행 탭 기본 기능 구현**
   - 참가자 목록 표시
   - 추첨 시작/중지
3. **기본 애니메이션 구현**
   - 룰렛 스크롤 효과

### Phase 4: 고급 기능 (2-3일)
1. **고급 애니메이션 구현**
   - confetti 효과
   - 카드 애니메이션
2. **결과 관리 기능 구현**
   - 결과 저장/조회
   - 내보내기 기능
3. **사용자 경험 개선**

### Phase 5: 최적화 및 테스트 (1-2일)
1. **성능 최적화**
2. **사용자 경험 개선**
3. **테스트 및 버그 수정**

---

## 📝 API 함수 설계

### 1. 경품추첨 관리
- `createPrizeDraw(eventId, data)`
- `getPrizeDraws(eventId)`
- `updatePrizeDraw(prizeDrawId, data)`
- `deletePrizeDraw(prizeDrawId)`

### 2. 경품 관리
- `createPrize(prizeDrawId, data)`
- `getPrizes(prizeDrawId)`
- `updatePrize(prizeId, data)`
- `deletePrize(prizeId)`

### 3. 추첨 실행
- `executePrizeDraw(prizeDrawId)`
- `getPrizeWinners(prizeDrawId)`
- `resetPrizeDraw(prizeDrawId)`

---

이 계획에 따라 단계별로 기능을 구현하면, 사용자가 제안한 직관적이고 사용하기 편한 경품추첨 시스템을 만들 수 있습니다! 🎉